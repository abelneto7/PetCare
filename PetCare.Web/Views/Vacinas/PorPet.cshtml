@model List<PetCare.Web.Controllers.VacinasController.VacinaLinhaVm>
    @using PetCare.Web.Models

    @{
    ViewData["Title"] = "Vacinas do Pet";
    var pet = (Pet?)ViewBag.Pet;
    }

    <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
            <h3 class="mb-1">Vacinas</h3>
            <div class="text-muted">
                @if (pet != null)
            {
                <span>
                    Pet: <strong>@pet.Nome</strong>
                    <span class="text-muted">•</span>
                    Tutor: <strong>@(pet.Tutor?.Nome ?? "-")</strong>
                </span>
            }
            </div>
        </div>

        <div class="d-grid d-md-flex gap-2">
            @if (pet != null)
        {
            <a class="btn btn-dark" asp-action="Create" asp-route-petId="@pet.Id">Registrar vacina</a>
        }
            <a class="btn btn-outline-secondary" asp-controller="Pets" asp-action="Index">Voltar</a>
        </div>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-body">
            @if (Model.Count == 0)
        {
            <div class="text-muted">Nenhuma vacina registrada para este pet.</div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table align-middle mb-0">
                    <thead>
                        <tr class="text-muted">
                            <th>Vacina</th>
                            <th>Aplicação</th>
                            <th>Próxima dose</th>
                            <th>Status</th>
                            <th>Observação</th>
                            <th class="text-end" style="width: 180px;">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var row in Model)
                        {
                            var v = row.Vacina;

                            string badgeClass;
                            string statusText;

                            switch (row.Status)
                            {
                                case StatusVacina.Atrasada:
                                    badgeClass = "bg-danger text-white";
                                    statusText = "Atrasada";
                                    break;

                                case StatusVacina.VenceEmBreve:
                                    badgeClass = "bg-warning text-dark";
                                    statusText = "Vence em breve";
                                    break;

                                default:
                                    badgeClass = "bg-success text-white";
                                    statusText = "Em dia";
                                    break;
                            }

                        <tr class="@(row.Status == StatusVacina.Atrasada ? "table-danger" : "")">
                            <td class="fw-semibold">@v.NomeVacina</td>
                            <td>@v.DataAplicacao.ToString("dd/MM/yyyy")</td>
                            <td>@v.ProximaDose.ToString("dd/MM/yyyy")</td>
                            <td>
                                <span class="badge @badgeClass">@statusText</span>
                            </td>
                            <td>
                                <span class="text-muted">
                                    @(string.IsNullOrWhiteSpace(v.Observacao) ? "-" : v.Observacao)
                                </span>
                            </td>
                            <td class="text-end">
                                <a class="btn btn-sm btn-outline-secondary" asp-action="Edit" asp-route-id="@v.Id">Editar</a>
                                <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@v.Id">Excluir</a>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mt-3 text-muted">
                <small>
                    Regra: <strong>Atrasada</strong> quando a próxima dose é anterior a hoje; <strong>Vence em breve</strong> quando vence em até 7 dias.
                </small>
            </div>
        }
        </div>
    </div>
